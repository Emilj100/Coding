{% extends "dashboard_layout.html" %}

{% block title %}Training Analytics{% endblock %}

{% block main %}
<div class="container mt-4">
    <div class="mb-3">
        <h2 class="fw-bold">Analyze your weekly training performance</h2>
        <p class="text-muted">
            Week: {{ start_of_week }} to {{ end_of_week }}
        </p>
    </div>

    <!-- Overview Cards -->
    <div class="row mb-4">
        <!-- Total Sessions This Week -->
        <div class="col-md-4">
            <div class="card text-center p-4 shadow-sm">
                <i class="bi bi-graph-up fs-2 text-primary"></i>
                <h5 class="mt-3">Total Sessions This Week</h5>
                <h3 class="fw-bold">{{ total_sessions }}</h3>
            </div>
        </div>
        <!-- Average Weight Increase -->
        <div class="col-md-4">
            <div class="card text-center p-4 shadow-sm">
                <i class="bi bi-bar-chart-line fs-2 text-success"></i>
                <h5 class="mt-3">Average Weight Increase</h5>
                <h3 class="fw-bold">
                    {% if avg_weight_increase >= 0 %}
                        +{{ avg_weight_increase }} kg
                    {% else %}
                        {{ avg_weight_increase }} kg
                    {% endif %}
                </h3>
            </div>
        </div>
        <!-- Total Sets This Week -->
        <div class="col-md-4">
            <div class="card text-center p-4 shadow-sm">
                <i class="bi bi-layers fs-2 text-warning"></i>
                <h5 class="mt-3">Total Sets This Week</h5>
                <h3 class="fw-bold">{{ total_sets }}</h3>
            </div>
        </div>
    </div>

    <!-- Training Sessions Overview -->
    <div class="card p-4 shadow-sm mb-4">
        <h4 class="fw-bold">Training Sessions This Week</h4>
        <ul class="list-group list-group-flush">
            {% for session in sessions_overview %}
                <li class="list-group-item">
                    {{ session.session_date }} ({{ session.day_name }}) - {{ session.exercises_count }} exercises
                </li>
            {% else %}
                <li class="list-group-item">No sessions recorded.</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Volume Per Muscle Group -->
    <h4 class="fw-bold mb-3">Volume Per Muscle Group (kg)</h4>
    <div class="row mb-4">
        {% for row in volume_data %}
        <div class="col-md-4">
            <div class="card text-center p-4 shadow-sm">
                <h5>{{ row.muscle | capitalize }}</h5>
                <h3 class="fw-bold">{{ row.total_volume if row.total_volume is not none else 0 }} kg</h3>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Charts -->
    <div class="row">
        <div class="col-md-6">
            <h5 class="fw-bold">Training Frequency (Last 4 Weeks)</h5>
            <canvas id="trainingFrequencyChart"></canvas>
        </div>
        <div class="col-md-6">
            <h5 class="fw-bold">Progression Over Time</h5>
            <canvas id="progressionChart"></canvas>
        </div>
    </div>
</div>

<script>
    // Training Frequency Chart
    const freqData = {{ freq_data | tojson | safe }};
    const freqLabels = freqData.map(d => d.week_range);
    const freqSessions = freqData.map(d => d.sessions);

    const freqCtx = document.getElementById('trainingFrequencyChart').getContext('2d');
    new Chart(freqCtx, {
        type: 'bar',
        data: {
            labels: freqLabels,
            datasets: [{
                label: 'Training Sessions',
                data: freqSessions,
                backgroundColor: '#007bff'
            }]
        }
    });

    // Progression Over Time Chart (Average Weight per Week)
    const progData = {{ progression_data | tojson | safe }};
    const progLabels = progData.map(d => d.week_range);
    const progWeights = progData.map(d => d.avg_weight);

    const progCtx = document.getElementById('progressionChart').getContext('2d');
    new Chart(progCtx, {
        type: 'line',
        data: {
            labels: progLabels,
            datasets: [{
                label: 'Avg Weight (kg)',
                data: progWeights,
                borderColor: '#007bff',
                backgroundColor: 'rgba(0, 123, 255, 0.2)',
                fill: true,
                tension: 0.3
            }]
        }
    });
</script>
{% endblock %}

